const express = require('express');
const router = express.Router();
const UserInfoModel = require('../models/user_signup');


router.post('/signup', (req, res) => {

  const signupobj = new UserInfoModel({
   
    username: req.body.username,
    email: req.body.email,
    phonenumber: req.body.phonenumber,
    password: req.body.password,
  });
  signupobj.save()
    .then(inserteddocument => {
      res.status(200).send('DOCUMENT INSERED IN MONGODB DATABASE' + '<br\>' + inserteddocument);
    })
    .catch(err => {
      res.status(500).send({ message: err.message || 'Error in Employee Save ' })
    });
}
);
router.post('/login', (req, res) => {

  const loginobj = new UserInfoModel({
   
    phonenumber: req.body.phonenumber,
    password: req.body.password,
  });
  loginobj.save()
    .then(inserteddocument => {
      res.status(200).send('DOCUMENT INSERED IN MONGODB DATABASE' + '<br\>' + inserteddocument);
    })
    .catch(err => {
      res.status(500).send({ message: err.message || 'Error in Employee Save ' })
    });
}
);

router.get('/viewall', (req, res) => {
    UserInfoModel.find()
    .then(getalldocumentsfrommongodb => {
      res.status(200).send(getalldocumentsfrommongodb);
    }) 
    .catch(err => {
      res.status(500).send({ message: err.message || 'Error in Fetch Employee ' })
    });
}       
); 
router.get('/search/:phonenumber', (req, res) => {
    UserInfoModel.find({ "phonenumber": parseInt(req.params.phonenumber) })
    .then(getsearchdocument => {
      if (getsearchdocument.length > 0) {
        res.send(getsearchdocument);
      }
      else {
        return res.status(404).send({ message: "Note not found with phone number " + req.params.phonenumber });
      }
    })
    .catch(err => {
      return res.status(500).send({ message: "DB Problem..Error in Retriving with phone number " + req.params.phonenumber });
    })
}
);


router.delete('/remove/:phonenumber', (req, res) => {
    console.log(req.params.phonenumber)
    UserInfoModel.findOneAndRemove({ "phonenumber": parseInt(req.params.phonenumber) })
    .then(deleteddocument => {
      if (deleteddocument != null) {
        res.status(200).send('DOCUMENT DELETED successfully!' + deleteddocument);
      }
      else {
        res.status(404).send('INVALID phone number' + req.params.phonenumber);
      }
    }) 
    .catch(err => {
      return res.status(500).send({ message: "DB Problem..Error in Delete with email " + req.params.phonenumber });
    })
}
);
module.exports = router;

